(function(){function m(a,c,d){"class"==c?a.className=d:"style"==c?a.defaultChecked=d:"for"==c?a.htmlFor=d:"checked"==c?a.style.cssText=d:a.setAttribute(c,d)}function v(a){a=a.charCodeAt(0);return 19968<=a&&40879>=a}function C(a){var c=[];if(3==a.nodeType){if(void 0==a.nodeValue)return;var d;d=a.nodeValue;for(var b=[],f=0;f<d.length;){for(var e=f+1,g=v(d.charAt(f));e<d.length&&v(d.charAt(e))==g;)++e;b.push([g,f,e]);f=e}d=1==b.length&&!v(d.charAt(b[0][1]))||0==b.length?[]:b;d.length&&c.push([a,d])}else if(1==
a.nodeType){if(a.nodeName.toLowerCase()in{textarea:1,"x-mspot":1,script:1,style:1,option:1})return;b=0;for(f=a.childNodes.length;b<f;++b)(d=C(a.childNodes[b]))&&(c=c.concat(d))}return c}function B(){document.getElementById("mandarinspot-progress").parentNode.style.display="none"}function D(a,c,d,b){var f=[],e;for(e in d){var g=d[e];void 0!=g&&f.push(e+"="+g)}var f=f.join("&"),h=new XMLHttpRequest;"withCredentials"in h?(h.open(a,c,!0),"POST"==a&&(h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),
h.setRequestHeader("Content-Length",String(f.length)))):"undefined"!=typeof XDomainRequest?(h=new XDomainRequest,h.open(a,c)):h=null;h.onload=function(){if(399<h.status)b(h.status);else{var a=eval("("+h.responseText+")");b(null,a)}};h.send(f)}function I(a,c){D("GET",a,{},c)}function J(a,c,d){D("POST",a,c,d)}function K(a,c,d){var b=["\r\n"],f;for(f in c){var e=c[f];void 0!=e&&b.push('Content-Disposition: form-data; name="'+f+'"\r\n\r\n'+e+"\r\n")}var b=b.join("--boundary\r\n")+"--boundary--\r\n",g=
new XMLHttpRequest;g.open("POST",a,!0);g.setRequestHeader("Content-Type","multipart/form-data; boundary=boundary");g.setRequestHeader("Content-Length",String(b.length));g.onreadystatechange=function(){if(4==g.readyState&&200==g.status){var a=eval("("+g.responseText+")");d(null,a)}};g.send(b)}function L(a){for(var c=[],d=0,b=a.length;d<b;++d){for(var f=a[d],e="",g=0,h=f.length;g<h;++g)e+=(f.charCodeAt(g)-8192).toString(32);c.push(e)}return c}function M(a){for(var c=[],d=0,b=a.length;d<b;++d){for(var f=
a[d],e="",g=0,h=f.length;g<h;++g)var p=f.charCodeAt(g),e=e+String.fromCharCode(224|15&p>>>12),e=e+String.fromCharCode(128|63&p>>>6),e=e+String.fromCharCode(128|63&p);c.push(e)}return c}function N(a,c){function d(a){var b=a.seg,d=A;a=a.defs;for(var f in a)d[f]=a[f];d=c;f=0;for(a=d.length;f<a;++f){for(var e=d[f][0],g=d[f][1],h=0,p=g.length;h<p;++h){var k=g[h],y=e.nodeValue.slice(k[1],k[2]),t=document.createTextNode(y);if(k[0])for(var k=b.shift(),n=0,m=0,x=k.length;m<x;++m){var E=parseInt(k[m],32),z=
document.createElement("wbr"),t=document.createTextNode(y.slice(n,n+E)),v=document.createElement("x-mspot");v.appendChild(t);var t=v,w=O;t.addEventListener?t.addEventListener("mouseover",w,!1):t.attachEvent?t.attachEvent("onmouseover",w):t.onmouseover=w;e.parentNode.insertBefore(z,e);e.parentNode.insertBefore(v,e);n+=E}else e.parentNode.insertBefore(t,e)}e.parentNode&&e.parentNode.removeChild(e)}B()}if(c.length){for(var b=[],f=0,e=c.length;f<e;++f)for(var g=c[f],h=g[0],g=g[1],p=0,k=g.length;p<k;++p){var y=
g[p];y[0]&&b.push(h.nodeValue.slice(y[1],y[2]))}f=P(M(b).join(",")+a);I(Q+f,function(c,e){if(404==c){if(z.g){var f=J;b=L(b).join(",")}else f=K,b=b.join(",");f(R,{str:b,phs:a},function(a,b){d(b)})}else d(e)})}else B()}function O(a,c){if(w){var d=a.target||a.srcElement;d.onmouseout=function(){n.style.visibility="hidden";n.style.left="-1000px";n.style.top="-1000px";n.style.width="";z.h(d)};z.i(d);c=c?c:d.lastChild.nodeValue?d.lastChild.nodeValue:d.lastChild.lastChild.nodeValue;var b=A[c][0],f=A[c][1],
e=A[c][2],g="";if(c!==e){for(var h=0;h<c.length;++h)g+=c[h]!==e[h]?e[h]:"-";g=" ["+g+"]"}e='<div id="mandarinspot-tip-hz" style="font-size:150%;"><x-mspot>'+c+g+"</x-mspot></div>";h=0;for(g=b.length;h<g;++h)var p=x?f[h].replace(/([^<])\//g,"$1 / "):"• "+f[h].replace(/([^<])\//g,"$1<br />• "),e=e+('<div id="mandarinspotspot-tip-py" style="font-weight:bold">'+b[h]+'</div><div id="mandarinspotspot-tip-en" style="text-align:left;font-size:90%">'+p+"</div>");mandarinspot.bookmark||(e+='<div id="mandarinspotspot-tip-fo" style="font-size:xx-small;color:#777;text-align:center;margin-top:1ex">MandarinSpot.com</div>');
n.innerHTML=e;z.j(d,n);n.style.visibility="visible"}}function S(a){var c=document.body;if("undefined"!=typeof c)if("undefined"==typeof a)a=document.body;else if("string"==typeof a){var d=a[0],b=a.slice(1);if("#"==d)return[document.getElementById(b)];if("."==d){if(c.getElementsByClassName)a=c.getElementsByClassName(b);else{a=[];for(var b=RegExp("(?:^| )"+b+"(?: |$)"),c=c.getElementsByTagName("*"),d=0,f=c.length;d<f;++d)b.test(c[d].className)&&a.push(c[d])}return a}}return[a]}function F(a,c){c=c||{};
var d=c.phonetic||"pinyin",b=c.show||!0,f=S(a),e=[];mandarinspot.bookmark?document.getElementById("mandarinspot-progress").parentNode.style.display="block":B();for(var g=0,h=f.length;g<h;++g)e=e.concat(C(f[g]));document.getElementById("mandarinspot-progress").innerHTML="Loading...";N(d,e);w=b}function P(a){function c(a){var b="",c,d;for(c=7;0<=c;c--)d=a>>>4*c&15,b+=d.toString(16);return b}function d(a,b){return a<<b|a>>>32-b}var b,f,e=Array(80),g=1732584193,h=4023233417,p=2562383102,k=271733878,n=
3285377520,l,q,r,s,m;l=a.length;var u=[];for(b=0;b<l-3;b+=4)f=a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|a.charCodeAt(b+3),u.push(f);switch(l%4){case 0:b=2147483648;break;case 1:b=a.charCodeAt(l-1)<<24|8388608;break;case 2:b=a.charCodeAt(l-2)<<24|a.charCodeAt(l-1)<<16|32768;break;case 3:b=a.charCodeAt(l-3)<<24|a.charCodeAt(l-2)<<16|a.charCodeAt(l-1)<<8|128}for(u.push(b);14!=u.length%16;)u.push(0);u.push(l>>>29);u.push(l<<3&4294967295);for(a=0;a<u.length;a+=16){for(b=0;16>b;b++)e[b]=
u[a+b];for(b=16;79>=b;b++)e[b]=d(e[b-3]^e[b-8]^e[b-14]^e[b-16],1);f=g;l=h;q=p;r=k;s=n;for(b=0;19>=b;b++)m=d(f,5)+(l&q|~l&r)+s+e[b]+1518500249&4294967295,s=r,r=q,q=d(l,30),l=f,f=m;for(b=20;39>=b;b++)m=d(f,5)+(l^q^r)+s+e[b]+1859775393&4294967295,s=r,r=q,q=d(l,30),l=f,f=m;for(b=40;59>=b;b++)m=d(f,5)+(l&q|l&r|q&r)+s+e[b]+2400959708&4294967295,s=r,r=q,q=d(l,30),l=f,f=m;for(b=60;79>=b;b++)m=d(f,5)+(l^q^r)+s+e[b]+3395469782&4294967295,s=r,r=q,q=d(l,30),l=f,f=m;g=g+f&4294967295;h=h+l&4294967295;p=p+q&4294967295;
k=k+r&4294967295;n=n+s&4294967295}return(c(g)+c(h)+c(p)+c(k)+c(n)).toLowerCase()}var T=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]||document.documentElement,G=document.getElementsByTagName("body")[0]||document.documentElement,x=-1!=navigator.userAgent.toLowerCase().indexOf("mobile");window.mandarinspot||(window.mandarinspot={});var H="#mandarinspot-tip{text-align:center;z-index:10001;border:1px solid #773;border-radius:3px;background-color:#ffc;color:#000;padding:5px;padding-bottom:2px;font:normal 14px sans-serif,arial;visibility:hidden;position:absolute}#mandarinspot-progressslot{position:fixed;display:block;z-index:1000;top:0;left:0;width:100%;border:none}#mandarinspot-progress{margin:0 "+
(x?"0":"auto")+";padding:.4ex 0;background-color:#ff9;color:#000;width:22ex;text-align:center;font:normal 14px sans-serif,arial;border:none}#mandarinspot-tip-hz{font-size:150%;border:none}#mandarinspotspot-tip-py{font-weight:bold;border:none}#mandarinspotspot-tip-en{text-align:left;font-size:90%;border:none}#mandarinspotspot-tip-fo{font-size:xx-small;color:#777;text-align:center;margin-top:1ex;border:none}.mspot{margin:0;padding:0;border:none;width:auto;height:auto}",k=document.createElement("style");
m(k,"type","text/css");k.styleSheet?k.styleSheet.cssText=H:k.appendChild(document.createTextNode(H));T.appendChild(k);document.getElementById("mandarinspot-tip")||(k=document.createElement("div"),m(k,"id","mandarinspot-tip"),m(k,"class","mspot"),G.appendChild(k));document.getElementById("mandarinspot-progressslot")||(k=document.createElement("div"),m(k,"id","mandarinspot-progressslot"),m(k,"class","mspot"),mandarinspot.bookmark||(k.style.display="none"),k.innerHTML='<div id="mandarinspot-progress">Loading..</div>',
G.appendChild(k));var Q="https://api.mandarinspot.com/cache/",R="https://api.mandarinspot.com/getdefs",A={},z={d:x?200:300,e:x?50:100,c:"",i:function(a){this.c=a.style.backgroundColor;a.style.backgroundColor="#fe7"},h:function(a){a.style.backgroundColor=this.c},f:function(a){return a.getBoundingClientRect?(a=a.getBoundingClientRect(),[a.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft),a.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)]):
[this.a(a),this.b(a)]},a:function(a){return(a.offsetLeft||0)+(a.offsetParent&&this.a(a.offsetParent)||0)},b:function(a){return(a.offsetTop||0)+(a.offsetParent&&this.b(a.offsetParent)||0)},j:function(a,c){var d=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,b=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,f=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,e=window.pageYOffset||document.documentElement.scrollTop||
document.body.scrollTop,g=this.f(a),h=g[0],k=g[1],g=!1;c.offsetWidth>this.d?c.style.width=this.d+"px":c.offsetWidth<this.e&&(c.style.width=this.e+"px");k=k-e>c.offsetHeight+15?k-3-c.offsetHeight:k+3+a.offsetHeight;if(k<e||k+c.offsetHeight>e+b)k=e,g=!0;c.style.top=k+"px";x?tipleft=Math.max(f,h-c.offsetWidth):g?tipleft=0>a.offsetWidth||h<c.offsetWidth?h+a.offsetWidth:h-c.offsetWidth:(b=Math.min(30,Math.abs(a.offsetWidth)/2),tipleft=d+f-h-a.offsetWidth<c.offsetWidth+15?h+b-c.offsetWidth:h+b,0>tipleft&&
(tipleft=0));c.style.left=tipleft+"px"},g:document.all},n=document.getElementById("mandarinspot-tip"),w=!0;window.mandarinspot||(window.mandarinspot={});mandarinspot.annotate=F;mandarinspot.showPopups=function(a){w=a};mandarinspot.supported=function(){return"withCredentials"in new XMLHttpRequest||"undefined"!=typeof XDomainRequest?!0:!1};mandarinspot.run=function(){F(document.body,{phonetic:mandarinspot.phonetic,show:!0})};mandarinspot.bookmark&&mandarinspot.run()})();
